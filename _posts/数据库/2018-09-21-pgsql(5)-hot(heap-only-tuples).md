---
layout: post
title: PGSQL(5)-HOT(Heap Only Tuples)
author: itsxun
date: 2018-09-21 17:30:43 +0800
catalog: true
tags:
    - 数据库
---

## 什么是HOT

pgsql 8.3加入的一个重要的性能特性，允许重新利用那些被update或者delete后失效的空间。

## 有什么用

更新行的时候不更新索引，提高更新的性能

## 如何实现

在更新行的时候，如果发现所更新的列中索引列不在里面，如果当前页还有剩余空间，新复制出来的行会放在和老的行同一页。然后老的数据会指向新的数据。

## 一些细节

1. 在根据更新链路往下查找最新的数据时候，如果发现了某一个老数据已经没有事务在使用了，它会顺便清理掉这个老数据，这被称为 mini-vacuum，但是它不能替代vacuum。

2. 表在创建之初， 可以use a larger fill factor setting，意思是，当当前的页面的数据大小占了总容量多少百分比时，之后的数据写入下一页，不再写新数据进当前页。这个好处是，可以预留出空间给HOT，提高数据库更新效率。 
